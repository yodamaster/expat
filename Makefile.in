################################################################
# Process this file with top-level configure script to produce Makefile
#
# Copyright 2000 Clark Cooper
#
#  This file is part of EXPAT.
#
#  EXPAT is free software; you can redistribute it and/or modify it
#  under the terms of the License (based on the MIT/X license) contained
#  in the file COPYING that comes with this distribution.
#
# EXPAT IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
# IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
# CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
# TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
# SOFTWARE OR THE USE OR OTHER DEALINGS IN EXPAT.
#
#  ---
#  I started using automake, but
#		1) it seemed like overkill
#		2) I don't want all the GNU policies
#		3) I wanted more explicit control over what gets built
#
#  So I'm doing my Makefile.in files manually. But a fair part is based
#  on what I learned from perusing the Makefile.in's generated by automake,
#  and the automake authors still get my kudos.
#

SHELL = @SHELL@

srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@

bindir = @bindir@
libdir = @libdir@
includedir = @includedir@

top_builddir = .


INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_SCRIPT = @INSTALL_SCRIPT@
mkinstalldirs = $(SHELL) $(top_srcdir)/conftools/mkinstalldirs

CC = @CC@

LIBTOOL = @LIBTOOL@
VERSION = @VERSION@

SUBDIRS = lib examples xmlwf
CONFIG_HEADERS = config.h

APIHEADER = expat.h
LIBRARY = libexpat.la


DISTDIR = expat-$(VERSION)
DISTRIBUTION = $(DISTDIR).tar.gz


default:  lib xmlwf

buildlib: lib

all: $(SUBDIRS)

$(SUBDIRS):
	cd $@ && $(MAKE)

clean:
	# clean up the lib dir
	cd lib && rm -f $(LIBRARY) *.o *.lo && rm -rf .libs _libs
	# clean up the xmlwf dir
	cd xmlwf && rm -f xmlwf *.o
	# clean up the examples dir
	cd examples && rm -f elements outline *.o
	# other random cleanup
	find . -name core | xargs rm -f

distclean: clean
	rm -f config.h config.status config.log config.cache libtool
	rm -f Makefile lib/Makefile examples/Makefile xmlwf/Makefile tests/Makefile
	rm -f lib/expat.h

extraclean: distclean
	rm -f aclocal.m4 config.h.in configure
	rm -f conftools/config.guess conftools/config.sub
	rm -f conftools/ltconfig conftools/ltmain.sh

maintainer-clean: distclean
	rm -f $(DISTRIBUTION)
	rm -rf $(DISTDIR)

distdir: MANIFEST
	test -d $(DISTDIR) && rm -rf $(DISTDIR); \
	mkdir $(DISTDIR); \
	flist=`sed -e "s/[ 	]:.*$$//" MANIFEST`; for file in $$flist; do \
		cp -P $$file $(DISTDIR); \
	done

check:	$(SUBDIRS)
	cd tests && $(MAKE) check

$(DISTRIBUTION): distdir
	tar cf - $(DISTDIR) | gzip -9 >$(DISTRIBUTION)

dist: $(DISTRIBUTION)

install: xmlwf/xmlwf lib/$(LIBRARY) lib/$(APIHEADER)
	$(mkinstalldirs) $(bindir) $(libdir) $(includedir)
	$(LIBTOOL) --mode=install $(INSTALL_PROGRAM) xmlwf/xmlwf $(bindir)/xmlwf
	$(LIBTOOL) --mode=install $(INSTALL) lib/$(LIBRARY) $(libdir)/$(LIBRARY)
	$(INSTALL_DATA) lib/$(APIHEADER) $(includedir)

uninstall:
	$(LIBTOOL) --mode=uninstall rm -f $(bindir)/xmlwf
	$(LIBTOOL) --mode=uninstall rm -f $(libdir)/$(LIBRARY)
	rm -f $(libdir)/$(APIHEADER)

.PHONY: buildlib all $(SUBDIRS) \
	clean distclean extraclean maintainer-clean \
	dist distdir \
	install uninstall
